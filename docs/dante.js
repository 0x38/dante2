webpackJsonp([1],{0:function(e,t,n){"use strict";n(280);var r=n(191);window.Dante=r.Dante,window.Dante.DanteEditor=r.DanteEditor},25:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNewBlockAt=t.updateTextOfBlock=t.updateDataOfBlock=t.resetBlockWithType=t.addNewBlock=t.getCurrentBlock=t.getNode=t.getDefaultBlockData=void 0;var r=n(41),o=n(9),i=t.getDefaultBlockData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){default:return t}},a=(t.getNode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=null;return e.getSelection?t=e.getSelection():e.document.getSelection?t=e.document.getSelection():e.document.selection&&(t=e.document.selection.createRange().text),t},t.getCurrentBlock=function(e){var t=e.getSelection(),n=e.getCurrentContent(),r=n.getBlockForKey(t.getStartKey());return r});t.addNewBlock=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unstyled",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.getSelection();if(!r.isCollapsed())return e;var l=e.getCurrentContent(),s=r.getStartKey(),u=l.getBlockMap(),c=a(e);if(!c)return e;if(0===c.getLength()){if(c.getType()===t)return e;var d=c.merge({type:t,data:i(t,n)}),p=l.merge({blockMap:u.set(s,d),selectionAfter:r});return o.EditorState.push(e,p,"change-block-type")}return e},t.resetBlockWithType=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unstyled",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.getCurrentContent(),a=e.getSelection(),l=a.getStartKey(),s=r.getBlockMap(),u=s.get(l),c="";console.log("DATA FOR PLACEHOLDER!",n);var d=u.getText();u.getLength()>=2&&(c=d.substr(1));var p=u.merge({text:c,type:t,data:i(t,n)}),f=r.merge({blockMap:s.set(l,p),selectionAfter:a.merge({anchorOffset:0,focusOffset:0})});return o.EditorState.push(e,f,"change-block-type")},t.updateDataOfBlock=function(e,t,n){var r=e.getCurrentContent(),i=t.merge({data:n}),a=r.merge({blockMap:r.getBlockMap().set(t.getKey(),i)});return o.EditorState.push(e,a,"change-block-type")},t.updateTextOfBlock=function(e,t,n){var r=e.getCurrentContent(),i=t.merge({text:n}),a=r.merge({blockMap:r.getBlockMap().set(t.getKey(),i)});return o.EditorState.push(e,a,"change-block-type")},t.addNewBlockAt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unstyled",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=e.getCurrentContent(),s=l.getBlockMap(),u=s.get(t),c=s.toSeq().takeUntil(function(e){return e===u}),d=s.toSeq().skipUntil(function(e){return e===u}).rest(),p=(0,o.genKey)(),f=new o.ContentBlock({key:p,type:n,text:"",characterList:u.getCharacterList().slice(0,0),depth:0,data:(0,r.Map)(i(n,a))}),h=c.concat([[t,u],[p,f]],d).toOrderedMap(),g=e.getSelection(),y=l.merge({blockMap:h,selectionBefore:g,selectionAfter:g.merge({anchorKey:p,anchorOffset:0,focusKey:p,focusOffset:0,isBackward:!1})});return o.EditorState.push(e,y,"split-block")}},48:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectionRect=function(e){var t=e.getRangeAt(0).getBoundingClientRect(),n=t&&t.top?t:e.getRangeAt(0).getClientRects()[0];if(!n){if(!e.anchorNode||!e.anchorNode.getBoundingClientRect)return null;n=e.anchorNode.getBoundingClientRect(),n.isEmptyline=!0}return n},t.getSelection=function(e){var t=null;return e.getSelection?t=e.getSelection():e.document.getSelection?t=e.document.getSelection():e.document.selection&&(t=e.document.selection.createRange().text),t},t.getSelectedBlockNode=function(e){var t=e.getSelection();if(0===t.rangeCount)return null;var n=t.getRangeAt(0).startContainer;do{if(n.getAttribute&&"true"===n.getAttribute("data-block"))return n;n=n.parentNode}while(null!==n);return null}},143:function(e,t,n){e.exports=n.p+"fonts/dante.eot"},144:function(e,t,n){e.exports=n.p+"fonts/fontello.eot"},191:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DanteEditor=exports.Dante=void 0;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_react=__webpack_require__(6),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(13),_reactDom2=_interopRequireDefault(_reactDom),_immutable=__webpack_require__(41),_immutable2=_interopRequireDefault(_immutable),_draftJs=__webpack_require__(9),_DraftPasteProcessor=__webpack_require__(117),_DraftPasteProcessor2=_interopRequireDefault(_DraftPasteProcessor),_draftConvert=__webpack_require__(213),_isSoftNewlineEvent=__webpack_require__(263),_isSoftNewlineEvent2=_interopRequireDefault(_isSoftNewlineEvent),_index=__webpack_require__(25),_image=__webpack_require__(199),_image2=_interopRequireDefault(_image),_link=__webpack_require__(200),_link2=_interopRequireDefault(_link),_selection=__webpack_require__(48),_addButton=__webpack_require__(198),_addButton2=_interopRequireDefault(_addButton),_toolTip=__webpack_require__(201),_toolTip2=_interopRequireDefault(_toolTip),_link3=__webpack_require__(197),_link4=_interopRequireDefault(_link3),_debug=__webpack_require__(196),_debug2=_interopRequireDefault(_debug),_find_entities=__webpack_require__(203),_find_entities2=_interopRequireDefault(_find_entities),_image3=__webpack_require__(193),_image4=_interopRequireDefault(_image3),_embed=__webpack_require__(192),_embed2=_interopRequireDefault(_embed),_video=__webpack_require__(195),_video2=_interopRequireDefault(_video),_placeholder=__webpack_require__(194),_placeholder2=_interopRequireDefault(_placeholder),_save_content=__webpack_require__(205),_save_content2=_interopRequireDefault(_save_content),_html2content=__webpack_require__(204),_html2content2=_interopRequireDefault(_html2content),Dante=exports.Dante=function(){function e(t){_classCallCheck(this,e),null==t&&(t={}),console.log("init editor Dante!");var n=(0,_immutable.Map)((0,_immutable.fromJS)(this.defaultOptions(t)));this.options=n.mergeDeep(t).toJS(),console.log(this.options)}return _createClass(e,[{key:"defaultOptions",value:function t(e){null==e&&(e={});var t={};return t.el="app",t.content="",t.read_only=!1,t.spellcheck=!1,t.title_placeholder="Title",t.body_placeholder="Write your story",t.widgets=[{title:"add an image",icon:"image",type:"image",block:_image4["default"],editable:!0,renderable:!0,breakOnContinuous:!0,wrapper_class:"graf graf--figure",selected_class:"is-selected is-mediaFocused",selectedFn:function(e){var t=e.getData().toJS(),n=t.direction;switch(n){case"left":return"graf--layoutOutsetLeft";case"center":return"";case"wide":return"sectionLayout--fullWidth";case"fill":return"graf--layoutFillWidth"}},handleEnterWithoutText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))},handleEnterWithText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))},widget_options:{displayOnInlineTooltip:!0,insertion:"upload",insert_block:"image"},options:{upload_url:e.upload_url,upload_headers:e.upload_headers,upload_callback:e.image_upload_callback,image_delete_callback:e.image_delete_callback,image_caption_placeholder:e.image_caption_placeholder}},{icon:"embed",title:"insert embed",type:"embed",block:_embed2["default"],editable:!0,renderable:!0,breakOnContinuous:!0,wrapper_class:"graf graf--mixtapeEmbed",selected_class:"is-selected is-mediaFocused",widget_options:{displayOnInlineTooltip:!0,insertion:"placeholder",insert_block:"embed"},options:{endpoint:"//api.embed.ly/1/extract?key="+e.api_key+"&url=",placeholder:"Paste a link to embed content from another site (e.g. Twitter) and press Enter"},handleEnterWithoutText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))},handleEnterWithText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))}},{icon:"video",title:"insert video",editable:!0,type:"video",block:_video2["default"],renderable:!0,breakOnContinuous:!0,wrapper_class:"graf--figure graf--iframe",selected_class:" is-selected is-mediaFocused",widget_options:{displayOnInlineTooltip:!0,insertion:"placeholder",insert_block:"video"},options:{endpoint:"//api.embed.ly/1/oembed?key="+e.api_key+"&url=",placeholder:"Paste a YouTube, Vine, Vimeo, or other video link, and press Enter",caption:"Type caption for embed (optional)"},handleEnterWithoutText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))},handleEnterWithText:function(e,t){var n=e.state.editorState;return e.onChange((0,_index.addNewBlockAt)(n,t.getKey()))}},{renderable:!0,editable:!0,block:_placeholder2["default"],type:"placeholder",wrapper_class:"is-embedable",selected_class:" is-selected is-mediaFocused",widget_options:{displayOnInlineTooltip:!1},handleEnterWithText:function(e,t){var n=e.state.editorState,r={provisory_text:t.getText(),endpoint:t.getData().get("endpoint"),type:t.getData().get("type")};return e.onChange((0,_index.resetBlockWithType)(n,r.type,r))}}],t.tooltips=[{ref:"insert_tooltip",component:_toolTip2["default"],displayOnSelection:!0,selectionElements:["unstyled","blockquote","ordered-list","unordered-list","unordered-list-item","ordered-list-item","code-block","header-one","header-two","header-three","header-four"],widget_options:{block_types:[{label:"h2",style:"header-one",type:"block"},{label:"h3",style:"header-two",type:"block"},{label:"h4",style:"header-three",type:"block"},{label:"blockquote",style:"blockquote",type:"block"},{label:"insertunorderedlist",style:"unordered-list-item",type:"block"},{label:"insertorderedlist",style:"ordered-list-item",type:"block"},{label:"code",style:"code-block",type:"block"},{label:"bold",style:"BOLD",type:"inline"},{label:"italic",style:"ITALIC",type:"inline"}]}},{ref:"add_tooltip",component:_addButton2["default"]},{ref:"anchor_popover",component:_link2["default"]},{ref:"image_popover",component:_image2["default"]}],t.xhr={before_handler:null,success_handler:null,error_handler:null},t.data_storage={url:null,method:"POST",success_handler:null,failure_handler:null,interval:1500},t.default_wrappers=[{className:"graf--p",block:"unstyled"},{className:"graf--h2",block:"header-one"},{className:"graf--h3",block:"header-two"},{className:"graf--h4",block:"header-three"},{className:"graf--blockquote",block:"blockquote"},{className:"graf--insertunorderedlist",block:"unordered-list-item"},{className:"graf--insertorderedlist",block:"ordered-list-item"},{className:"graf--code",block:"code-block"},{className:"graf--bold",block:"BOLD"},{className:"graf--italic",block:"ITALIC"}],t.continuousBlocks=["unstyled","blockquote","ordered-list","unordered-list","unordered-list-item","ordered-list-item","code-block"],t.key_commands={"alt-shift":[{key:65,cmd:"add-new-block"}],"alt-cmd":[{key:49,cmd:"toggle_block:header-one"},{key:50,cmd:"toggle_block:header-two"},{key:53,cmd:"toggle_block:blockquote"}],cmd:[{key:66,cmd:"toggle_inline:BOLD"},{key:73,cmd:"toggle_inline:ITALIC"},{key:75,cmd:"insert:link"}]},t.character_convert_mapping={"> ":"blockquote","*.":"unordered-list-item","* ":"unordered-list-item","- ":"unordered-list-item","1.":"ordered-list-item","# ":"header-one","##":"header-two","==":"unstyled","` ":"code-block"},t}},{key:"getContent",value:function(){return this.options.content}},{key:"render",value:function(){return this.editor=_reactDom2["default"].render(_react2["default"].createElement(DanteEditor,{content:this.getContent(),config:this.options}),document.getElementById(this.options.el))}}]),e}(),DanteEditor=exports.DanteEditor=function(_React$Component){function DanteEditor(e){_classCallCheck(this,DanteEditor);var t=_possibleConstructorReturn(this,(DanteEditor.__proto__||Object.getPrototypeOf(DanteEditor)).call(this,e));return t.initializeState=t.initializeState.bind(t),t.refreshSelection=t.refreshSelection.bind(t),t.forceRender=t.forceRender.bind(t),t.onChange=t.onChange.bind(t),t.dispatchChangesToSave=t.dispatchChangesToSave.bind(t),t.setPreContent=t.setPreContent.bind(t),t.focus=t.focus.bind(t),t.getEditorState=t.getEditorState.bind(t),t.emitSerializedOutput=t.emitSerializedOutput.bind(t),t.decodeEditorContent=t.decodeEditorContent.bind(t),t.getTextFromEditor=t.getTextFromEditor.bind(t),t.getLocks=t.getLocks.bind(t),t.addLock=t.addLock.bind(t),t.removeLock=t.removeLock.bind(t),t.renderableBlocks=t.renderableBlocks.bind(t),t.defaultWrappers=t.defaultWrappers.bind(t),t.blockRenderer=t.blockRenderer.bind(t),t.handleBlockRenderer=t.handleBlockRenderer.bind(t),t.blockStyleFn=t.blockStyleFn.bind(t),t.getDataBlock=t.getDataBlock.bind(t),t.styleForBlock=t.styleForBlock.bind(t),t.handlePasteText=t.handlePasteText.bind(t),t.handleTXTPaste=t.handleTXTPaste.bind(t),t.handleHTMLPaste=t.handleHTMLPaste.bind(t),t.handlePasteImage=t.handlePasteImage.bind(t),t.handleDroppedFiles=t.handleDroppedFiles.bind(t),t.handleUpArrow=t.handleUpArrow.bind(t),t.handleDownArrow=t.handleDownArrow.bind(t),t.handleReturn=t.handleReturn.bind(t),t.handleBeforeInput=t.handleBeforeInput.bind(t),t.handleKeyCommand=t.handleKeyCommand.bind(t),t.findCommandKey=t.findCommandKey.bind(t),t.KeyBindingFn=t.KeyBindingFn.bind(t),t.updateBlockData=t.updateBlockData.bind(t),t.setDirection=t.setDirection.bind(t),t.toggleEditable=t.toggleEditable.bind(t),t.closePopOvers=t.closePopOvers.bind(t),t.relocateTooltips=t.relocateTooltips.bind(t),t.tooltipsWithProp=t.tooltipsWithProp.bind(t),t.tooltipHasSelectionElement=t.tooltipHasSelectionElement.bind(t),t.handleShowPopLinkOver=t.handleShowPopLinkOver.bind(t),t.handleHidePopLinkOver=t.handleHidePopLinkOver.bind(t),t.showPopLinkOver=t.showPopLinkOver.bind(t),t.hidePopLinkOver=t.hidePopLinkOver.bind(t),t.render=t.render.bind(t),t.decorator=new _draftJs.CompositeDecorator([{strategy:_find_entities2["default"].bind(null,"LINK",t),component:_link4["default"]}]),t.blockRenderMap=(0,_immutable.Map)({image:{element:"figure"},video:{element:"figure"},embed:{element:"div"},unstyled:{wrapper:null,element:"div"},paragraph:{wrapper:null,element:"div"},placeholder:{wrapper:null,element:"div"}}),t.extendedBlockRenderMap=_draftJs.DefaultDraftBlockRenderMap.merge(t.blockRenderMap),t.state={editorState:t.initializeState(),read_only:t.props.config.read_only,blockRenderMap:t.extendedBlockRenderMap,locks:0,debug:t.props.config.debug},t.widgets=t.props.config.widgets,t.tooltips=t.props.config.tooltips,t.key_commands=t.props.config.key_commands,t.continuousBlocks=t.props.config.continuousBlocks,t.block_types=t.props.config.block_types,t.default_wrappers=t.props.config.default_wrappers,t.character_convert_mapping=t.props.config.character_convert_mapping,t.save=new _save_content2["default"]({getLocks:t.getLocks,config:{xhr:t.props.config.xhr,data_storage:t.props.config.data_storage},editorState:t.state.editorState,editorContent:t.emitSerializedOutput()}),t}return _inherits(DanteEditor,_React$Component),_createClass(DanteEditor,[{key:"initializeState",value:function(){return this.props.content?this.decodeEditorContent(this.props.content):_draftJs.EditorState.createEmpty(this.decorator)}},{key:"refreshSelection",value:function(e){var t=this.state.editorState,n=this.state.editorState.getSelection(),r=(t.getCurrentContent(),n.getFocusOffset()),o=n.getAnchorKey(),i=_draftJs.SelectionState.createEmpty(n.getAnchorKey());i=i.merge({anchorOffset:r,focusKey:o,focusOffset:r});var a=_draftJs.EditorState.forceSelection(e,i);return this.onChange(a)}},{key:"forceRender",value:function(e){var t=(this.state.editorState.getSelection(),e.getCurrentContent()),n=_draftJs.EditorState.createWithContent(t,this.decorator);return this.refreshSelection(n)}},{key:"onChange",value:function(e){var t=this;this.setPreContent(),this.setState({editorState:e});var n=(0,_index.getCurrentBlock)(this.state.editorState),r=n.getType();if(e.getSelection().isCollapsed())this.handleTooltipDisplayOn("displayOnSelection",!1);else{var o=this.tooltipsWithProp("displayOnSelection")[0];if(!this.tooltipHasSelectionElement(o,r))return;this.handleTooltipDisplayOn("displayOnSelection")}return setTimeout(function(){return t.relocateTooltips()},0),this.dispatchChangesToSave()}},{key:"dispatchChangesToSave",value:function(){var e=this;return clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){return e.save.store(e.emitSerializedOutput())},100)}},{key:"setPreContent",value:function(){var e=this.emitSerializedOutput();return this.save.editorContent=e}},{key:"focus",value:function(){}},{key:"getEditorState",value:function(){return this.state.editorState}},{key:"emitSerializedOutput",value:function(){var e=(0,_draftJs.convertToRaw)(this.state.editorState.getCurrentContent());return e}},{key:"decodeEditorContent",value:function(e){var t=(0,_draftJs.convertFromRaw)(e),n=void 0;return n=_draftJs.EditorState.createWithContent(t,this.decorator)}},{key:"getTextFromEditor",value:function(){var e=this.state.editorState.getCurrentContent(),t=e.getBlocksAsArray().map(function(e){return e.getText()}).join("\n");return t}},{key:"emitHTML2",value:function(){var e=void 0;return e=(0,_draftConvert.convertToHTML)({entityToHTML:function(e,t){return"LINK"===e.type?'<a href="'+e.data.url+'">'+t+"</a>":t}})(this.state.editorState.getCurrentContent())}},{key:"getLocks",value:function(){return this.state.locks}},{key:"addLock",value:function(){return this.setState({locks:this.state.locks+=1})}},{key:"removeLock",value:function(){return this.setState({locks:this.state.locks-=1})}},{key:"renderableBlocks",value:function(){return this.widgets.filter(function(e){return e.renderable}).map(function(e){return e.type})}},{key:"defaultWrappers",value:function(e){return this.default_wrappers.filter(function(t){return t.block===e}).map(function(e){return e.className})}},{key:"blockRenderer",value:function(e){switch(e.getType()){case"atomic":var t=e.getEntityAt(0);_draftJs.Entity.get(t).getType()}return this.renderableBlocks().includes(e.getType())?this.handleBlockRenderer(e):null}},{key:"handleBlockRenderer",value:function handleBlockRenderer(block){var dataBlock=this.getDataBlock(block);if(!dataBlock)return null;var read_only=!this.state.read_only&&null,editable=null!==read_only?read_only:dataBlock.editable;return{component:eval(dataBlock.block),editable:editable,props:{data:block.getData(),getEditorState:this.getEditorState,setEditorState:this.onChange,addLock:this.addLock,removeLock:this.removeLock,getLocks:this.getLocks,config:dataBlock.options}}}},{key:"blockStyleFn",value:function(e){var t=(0,_index.getCurrentBlock)(this.state.editorState),n=t.getKey()===e.getKey()?"is-selected":"";if(this.renderableBlocks().includes(e.getType()))return this.styleForBlock(e,t,n);var r=this.defaultWrappers(e.getType());return r.length>0?"graf "+r[0]+" "+n:"graf nana "+n}},{key:"getDataBlock",value:function(e){return this.widgets.find(function(t){return t.type===e.getType()})}},{key:"styleForBlock",value:function(e,t,n){var r=this.getDataBlock(e);if(!r)return null;var o=r.selectedFn?r.selectedFn(e):null,i=n?r.selected_class:"";return r.wrapper_class+" "+i+" "+o}},{key:"handleTooltipDisplayOn",value:function(e,t){var n=this;return null==t&&(t=!0),setTimeout(function(){var r=n.tooltipsWithProp(e);return r.map(function(e){return n.refs[e.ref].display(t),n.refs[e.ref].relocate()})},20)}},{key:"handlePasteText",value:function(e,t){return t?t?this.handleHTMLPaste(e,t):void 0:this.handleTXTPaste(e,t)}},{key:"handleTXTPaste",value:function(e,t){var n=(0,_index.getCurrentBlock)(this.state.editorState),r=this.state.editorState;switch(n.getType()){case"image":case"video":case"placeholder":var o=_draftJs.Modifier.replaceText(r.getCurrentContent(),new _draftJs.SelectionState({anchorKey:n.getKey(),anchorOffset:0,focusKey:n.getKey(),focusOffset:2}),e);return r=_draftJs.EditorState.push(r,o,"replace-text"),this.onChange(r),!0;default:return!1}}},{key:"handleHTMLPaste",value:function(e,t){var n=(0,_index.getCurrentBlock)(this.state.editorState);switch(n.getType()){case"image":case"video":case"placeholder":return this.handleTXTPaste(e,t)}var r=(0,_html2content2["default"])(t,this.extendedBlockRenderMap),o=this.state.editorState.getSelection(),i=o.getEndKey(),a=this.state.editorState.getCurrentContent(),l=a.blockMap.toSeq().takeUntil(function(e){return e.key===i}),s=a.blockMap.toSeq().skipUntil(function(e){return e.key===i}).rest(),u=r.blockMap.first().getKey(),c=l.concat(r.blockMap,s).toOrderedMap(),d=a.merge({blockMap:c,selectionBefore:o,selectionAfter:o.merge({anchorKey:u,anchorOffset:0,focusKey:u,focusOffset:0,isBackward:!1})}),p=_draftJs.EditorState.push(this.state.editorState,d,"insert-fragment");return this.onChange(p),!0}},{key:"handlePasteImage",value:function(e){var t=this;return e.map(function(e){var n={url:URL.createObjectURL(e),file:e};return t.onChange((0,_index.addNewBlock)(t.state.editorState,"image",n))})}},{key:"handleDroppedFiles",value:function(e,t){var n=this;return t.map(function(e){var t={url:URL.createObjectURL(e),file:e};return n.onChange((0,_index.addNewBlock)(n.state.editorState,"image",t))})}},{key:"handleUpArrow",value:function(e){var t=this;return setTimeout(function(){return t.forceRender(t.state.editorState)},10)}},{key:"handleDownArrow",value:function(e){var t=this;return setTimeout(function(){return t.forceRender(t.state.editorState)},10)}},{key:"handleReturn",value:function(e){if(this.props.handleReturn&&this.props.handleReturn())return!0;var t=this.state.editorState;if(!e.altKey&&!e.metaKey&&!e.ctrlKey){var n=(0,_index.getCurrentBlock)(t),r=n.getType(),o=t.getSelection(),i=this.getDataBlock(n);if(0===n.getText().length){if(i&&i.handleEnterWithoutText)return i.handleEnterWithText(this,n),this.closePopOvers(),!0;switch(r){case"header-one":return this.onChange((0,_index.resetBlockWithType)(t,"unstyled")),!0;default:return!1}}if(n.getText().length>0){if("unstyled"===r){var a=_draftJs.Modifier.splitBlock(this.state.editorState.getCurrentContent(),this.state.editorState.getSelection()),l=_draftJs.EditorState.push(this.state.editorState,a,"insert-characters");return this.onChange(l),setTimeout(function(){var e=document.getElementsByClassName("is-selected"),t=e[0].getBoundingClientRect();return window.scrollTo(0,t.top+window.scrollY-100)},0),!0}return i&&i.handleEnterWithText?(i.handleEnterWithText(this,n),this.closePopOvers(),!0):n.getLength()===o.getStartOffset()&&this.continuousBlocks.indexOf(r)<0&&(this.onChange((0,_index.addNewBlockAt)(t,n.getKey())),!0)}return n.getLength()===o.getStartOffset()&&this.continuousBlocks.indexOf(r)<0&&(this.onChange((0,_index.addNewBlockAt)(t,n.getKey())),!0)}}},{key:"handleBeforeInput",value:function(e){var t=(0,_index.getCurrentBlock)(this.state.editorState),n=t.getType(),r=this.state.editorState.getSelection(),o=this.state.editorState;0!==t.getText().length&&this.closePopOvers();var i=r.getEndOffset(),a=t.getEntityAt(i-1),l=a&&_draftJs.Entity.get(a).getType(),s=t.getEntityAt(i),u=s&&_draftJs.Entity.get(s).getType();if(" "===e&&"LINK"===l&&"LINK"!==u){var c=_draftJs.Modifier.insertText(o.getCurrentContent(),r," "),d=_draftJs.EditorState.push(o,c,"insert-characters");return this.onChange(d),!0}if(0===n.indexOf("atomic"))return!1;var p=t.getLength();if(r.getAnchorOffset()>1||p>1)return!1;var f=this.character_convert_mapping[t.getText()+e];return console.log("BLOCK TO SHOW: "+f),!!f&&(this.onChange((0,_index.resetBlockWithType)(o,f)),!0)}},{key:"handleKeyCommand",value:function(e){var t=this.state.editorState,n=void 0,r=void 0;if(this.props.handleKeyCommand&&this.props.handleKeyCommand(e))return!0;if("add-new-block"===e)return this.onChange((0,_index.addNewBlock)(t,"blockquote")),!0;var o=(0,_index.getCurrentBlock)(t);if(0===e.indexOf("toggle_inline:"))return r=e.split(":")[1],n=o.getType(),this.onChange(_draftJs.RichUtils.toggleInlineStyle(t,r)),!0;if(0===e.indexOf("toggle_block:"))return r=e.split(":")[1],n=o.getType(),this.onChange(_draftJs.RichUtils.toggleBlockType(t,r)),!0;var i=_draftJs.RichUtils.handleKeyCommand(this.state.editorState,e);return!!i&&(this.onChange(i),!0)}},{key:"findCommandKey",value:function(e,t){return this.key_commands[e].find(function(e){return e.key===t})}},{key:"KeyBindingFn",value:function(e){var t=void 0;if(e.altKey){if(e.shiftKey)return t=this.findCommandKey("alt-shift",e.which),t?t.cmd:(0,_draftJs.getDefaultKeyBinding)(e);if(e.ctrlKey||e.metaKey)return t=this.findCommandKey("alt-cmd",e.which),t?t.cmd:(0,_draftJs.getDefaultKeyBinding)(e)}else if(e.ctrlKey||e.metaKey)return t=this.findCommandKey("cmd",e.which),t?t.cmd:(0,_draftJs.getDefaultKeyBinding)(e);return(0,_draftJs.getDefaultKeyBinding)(e)}},{key:"updateBlockData",value:function(e,t){var n=e.getData(),r=n.merge(t),o=(0,_index.updateDataOfBlock)(this.state.editorState,e,r);return this.forceRender(o)}},{key:"setDirection",value:function(e){var t=this.state.editorState.getCurrentContent(),n=this.state.editorState.getSelection(),r=t.getBlockForKey(n.anchorKey);return this.updateBlockData(r,{direction:e})}},{key:"toggleEditable",value:function(){return this.closePopOvers(),this.setState({read_only:!this.state.read_only},this.testEmitAndDecode)}},{key:"closePopOvers",value:function(){var e=this;return this.tooltips.map(function(t){return e.refs[t.ref].hide()})}},{key:"relocateTooltips",value:function(){var e=this;return this.tooltips.map(function(t){return e.refs[t.ref].relocate()})}},{key:"tooltipsWithProp",value:function(e){return this.tooltips.filter(function(t){return t[e]})}},{key:"tooltipHasSelectionElement",value:function(e,t){return e.selectionElements.includes(t)}},{key:"handleShowPopLinkOver",value:function(e){return this.showPopLinkOver()}},{key:"handleHidePopLinkOver",value:function(e){return this.hidePopLinkOver()}},{key:"showPopLinkOver",value:function(e){var t=void _reactDom2["default"].findDOMNode(this);return this.refs.anchor_popover.setState({url:e?e.href:this.refs.anchor_popover.state.url}),e&&(t=this.refs.anchor_popover.relocate(e)),t&&this.refs.anchor_popover.setPosition(t),this.refs.anchor_popover.setState({show:!0}),this.isHover=!0,this.cancelHide()}},{key:"hidePopLinkOver",value:function(){var e=this;return this.hideTimeout=setTimeout(function(){return e.refs.anchor_popover.hide()},300)}},{key:"cancelHide",value:function(){return clearTimeout(this.hideTimeout)}},{key:"render",value:function(){var e=this;return _react2["default"].createElement("div",{id:"content",suppressContentEditableWarning:!0},_react2["default"].createElement("article",{className:"postArticle"},_react2["default"].createElement("div",{className:"postContent"},_react2["default"].createElement("div",{className:"notesSource"},_react2["default"].createElement("div",{id:"editor",className:"postField postField--body"},_react2["default"].createElement("section",{className:"section--first section--last"},_react2["default"].createElement("div",{className:"section-divider layoutSingleColumn"},_react2["default"].createElement("hr",{className:"section-divider"})),_react2["default"].createElement("div",{className:"section-content"},_react2["default"].createElement("div",{ref:"richEditor",className:"section-inner layoutSingleColumn",onClick:this.focus},_react2["default"].createElement(_draftJs.Editor,{blockRendererFn:this.blockRenderer,editorState:this.state.editorState,onChange:this.onChange,onUpArrow:this.handleUpArrow,onDownArrow:this.handleDownArrow,handleReturn:this.handleReturn,blockRenderMap:this.state.blockRenderMap,blockStyleFn:this.blockStyleFn,handlePastedText:this.handlePasteText,handlePastedFiles:this.handlePasteImage,handleDroppedFiles:this.handleDroppedFiles,handleKeyCommand:this.handleKeyCommand,keyBindingFn:this.KeyBindingFn,handleBeforeInput:this.handleBeforeInput,readOnly:this.state.read_only,placeholder:this.props.config.body_placeholder,ref:"editor"})))))))),this.tooltips.map(function(t,n){return _react2["default"].createElement(t.component,{ref:t.ref,key:n,editor:e,editorState:e.state.editorState,onChange:e.onChange,configTooltip:t,widget_options:t.widget_options,showPopLinkOver:e.showPopLinkOver,hidePopLinkOver:e.hidePopLinkOver,handleOnMouseOver:e.handleShowPopLinkOver,handleOnMouseOut:e.handleHidePopLinkOver})}),this.state.debug?_react2["default"].createElement(_debug2["default"],{locks:this.state.locks,editor:this}):void 0)}}]),DanteEditor}(_react2["default"].Component)},192:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=(r(c),n(9),n(47)),p=r(d),f=n(25),h=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.updateData=n.updateData.bind(n),n.dataForUpdate=n.dataForUpdate.bind(n),n.componentDidMount=n.componentDidMount.bind(n),n.state={embed_data:n.defaultData(),error:""},n}return a(t,e),l(t,[{key:"defaultData",value:function(){var e=this.props.block.getData().toJS();return e.embed_data||{}}},{key:"updateData",value:function(){var e=this.props,t=e.block,n=(e.blockProps,this.props.blockProps),r=n.getEditorState,o=n.setEditorState,i=t.getData(),a=i.merge(this.state);return o((0,f.updateDataOfBlock)(r(),t,a))}},{key:"dataForUpdate",value:function(){return this.props.blockProps.data.toJS()}},{key:"componentDidMount",value:function(){var e=this;if(this.props.blockProps.data&&(this.dataForUpdate().endpoint||this.dataForUpdate().provisory_text))return(0,p["default"])({method:"get",url:""+this.dataForUpdate().endpoint+this.dataForUpdate().provisory_text+"&scheme=https"}).then(function(t){return e.setState({embed_data:t.data},e.updateData)})["catch"](function(t){return e.setState({error:t.response.data.error_message}),console.log("TODO: error")})}},{key:"classForImage",value:function(){return this.state.embed_data.images?"":"mixtapeImage--empty u-ignoreBlock"}},{key:"picture",value:function(){return this.state.embed_data.images&&this.state.embed_data.images.length>0?this.state.embed_data.images[0].url:""}},{key:"render",value:function(){return console.log("ERROR",this.state.error),u["default"].createElement("span",null,this.picture()?u["default"].createElement("a",{target:"_blank",className:"js-mixtapeImage mixtapeImage "+this.classForImage(),href:this.state.embed_data.url,style:{backgroundImage:"url('"+this.picture()+"')"}}):void 0,this.state.error?u["default"].createElement("h2",null,this.state.error):void 0,u["default"].createElement("a",{
className:"markup--anchor markup--mixtapeEmbed-anchor",target:"_blank",href:this.state.embed_data.url},u["default"].createElement("strong",{className:"markup--strong markup--mixtapeEmbed-strong"},this.state.embed_data.title),u["default"].createElement("em",{className:"markup--em markup--mixtapeEmbed-em"},this.state.embed_data.description)),this.state.embed_data.provider_url)}}]),t}(u["default"].Component);t["default"]=h},193:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=r(6),c=o(u),d=r(13),p=(o(d),r(9)),f=r(47),h=o(f),g=r(25),y=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.blockPropsSrc=n.blockPropsSrc.bind(n),n.defaultUrl=n.defaultUrl.bind(n),n.defaultAspectRatio=n.defaultAspectRatio.bind(n),n.updateData=n.updateData.bind(n),n.replaceImg=n.replaceImg.bind(n),n.startLoader=n.startLoader.bind(n),n.stopLoader=n.stopLoader.bind(n),n.handleUpload=n.handleUpload.bind(n),n.aspectRatio=n.aspectRatio.bind(n),n.updateDataSelection=n.updateDataSelection.bind(n),n.handleGrafFigureSelectImg=n.handleGrafFigureSelectImg.bind(n),n.getUploadUrl=n.getUploadUrl.bind(n),n.uploadFile=n.uploadFile.bind(n),n.uploadCompleted=n.uploadCompleted.bind(n),n.updateProgressBar=n.updateProgressBar.bind(n),n.placeHolderEnabled=n.placeHolderEnabled.bind(n),n.placeholderText=n.placeholderText.bind(n),n.handleFocus=n.handleFocus.bind(n),n.render=n.render.bind(n);var r=n.props.block.getData().toJS();return n.config=n.props.blockProps.config,n.file=n.props.blockProps.data.get("file"),n.state={loading:!1,selected:!1,loading_progress:0,enabled:!1,caption:n.defaultPlaceholder(),direction:r.direction||"center",width:0,height:0,file:null,url:n.blockPropsSrc()||n.defaultUrl(r),aspect_ratio:n.defaultAspectRatio(r)},n}return l(t,e),s(t,[{key:"blockPropsSrc",value:function(){return this.props.blockProps.data.src}},{key:"defaultUrl",value:function(e){return e.url?e.url:e.url?e.file?URL.createObjectURL(e.file):e.url:this.props.blockProps.data.src}},{key:"defaultPlaceholder",value:function(){return this.props.blockProps.config.image_caption_placeholder}},{key:"defaultAspectRatio",value:function(e){return e.aspect_ratio?{width:e.aspect_ratio.width,height:e.aspect_ratio.height,ratio:e.aspect_ratio.ratio}:{width:0,height:0,ratio:100}}},{key:"getAspectRatio",value:function(e,t){var n=1e3,r=1e3,o=0,i=e,a=t;i>n?(o=n/i,a*=o,i*=o):a>r&&(o=r/a,i*=o,a*=o);var l=a/i*100,s={width:i,height:a,ratio:l};return s}},{key:"updateData",value:function(){var e=(this.props.blockProps,this.props.block),t=this.props.blockProps.getEditorState,n=this.props.blockProps.setEditorState,r=e.getData(),o=r.merge(this.state).merge({forceUpload:!1});return n((0,g.updateDataOfBlock)(t(),e,o))}},{key:"replaceImg",value:function(){var e=this;this.img=new Image,this.img.src=this.refs.image_tag.src,this.setState({url:this.img.src});var t=this;if(this.img.src.includes("blob:")||this.props.block.data.get("forceUpload"))return this.img.onload=function(){return e.setState({width:e.img.width,height:e.img.height,aspect_ratio:t.getAspectRatio(e.img.width,e.img.height)}),e.handleUpload()}}},{key:"startLoader",value:function(){return this.setState({loading:!0})}},{key:"stopLoader",value:function(){return this.setState({loading:!1})}},{key:"handleUpload",value:function(){return this.startLoader(),this.props.blockProps.addLock(),this.updateData(),this.uploadFile()}},{key:"componentDidMount",value:function(){return this.replaceImg()}},{key:"aspectRatio",value:function(){return{maxWidth:""+this.state.aspect_ratio.width,maxHeight:""+this.state.aspect_ratio.height,ratio:""+this.state.aspect_ratio.height}}},{key:"updateDataSelection",value:function(){var e=this.props.blockProps,t=e.getEditorState,n=e.setEditorState,r=t().getSelection().merge({anchorKey:this.props.block.getKey(),focusKey:this.props.block.getKey()});return n(p.EditorState.forceSelection(t(),r))}},{key:"handleGrafFigureSelectImg",value:function(e){return e.preventDefault(),this.setState({selected:!0},this.updateDataSelection)}},{key:"coords",value:function(){return{maxWidth:this.state.aspect_ratio.width+"px",maxHeight:this.state.aspect_ratio.height+"px"}}},{key:"getBase64Image",value:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0);var r=t.toDataURL("image/png");return r}},{key:"formatData",value:function(){var e=new FormData;if(this.file){var t=this.config.formName||"file";return e.append(t,this.file),e}return e.append("url",this.props.blockProps.data.get("url")),e}},{key:"getUploadUrl",value:function(){var e=this.config.upload_url;return"function"==typeof e?e():e}},{key:"getUploadHeaders",value:function(){return this.config.upload_headers||{}}},{key:"uploadFile",value:function(){var e=this,t=void 0;return(0,h["default"])({method:"post",url:this.getUploadUrl(),headers:this.getUploadHeaders(),data:this.formatData(),onUploadProgress:function(t){return e.updateProgressBar(t)}}).then(function(t){if(e.uploadCompleted(t.data),e.props.blockProps.removeLock(),e.stopLoader(),e.file=null,e.config.upload_callback)return e.config.upload_callback(response,e)})["catch"](function(t){if(e.props.blockProps.removeLock(),e.stopLoader(),console.log("ERROR: got error uploading file "+t),e.config.upload_error_callback)return e.config.upload_error_callback(t,e)}),t=function(t){return e.uploadCompleted(t,n)}}},{key:"uploadCompleted",value:function(e){return this.setState({url:e.url},this.updateData)}},{key:"updateProgressBar",value:function(e){var t=this.state.loading_progress;if(e.lengthComputable)return t=e.loaded/e.total*100,t=null!=t?t:{complete:0},this.setState({loading_progress:t}),console.log("complete: "+t)}},{key:"placeHolderEnabled",value:function(){return this.state.enabled||this.props.block.getText()}},{key:"placeholderText",value:function(){return this.placeHolderEnabled()?"":"Write caption for image (optional)"}},{key:"handleFocus",value:function(e){var t=this;return setTimeout(function(){return t.setState({enabled:!0})},0)}},{key:"render",value:function(){return c["default"].createElement("div",{ref:"image_tag2",suppressContentEditableWarning:!0},c["default"].createElement("div",{className:"aspectRatioPlaceholder is-locked",style:this.coords(),onClick:this.handleGrafFigureSelectImg},c["default"].createElement("div",{style:{paddingBottom:this.state.aspect_ratio.ratio+"%"},className:"aspect-ratio-fill"}),c["default"].createElement("img",{src:this.state.url,ref:"image_tag",height:this.state.aspect_ratio.height,width:this.state.aspect_ratio.width,className:"graf-image"}),c["default"].createElement(m,{toggle:this.state.loading,progress:this.state.loading_progress})),c["default"].createElement("figcaption",{className:"imageCaption",onMouseDown:this.handleFocus},this.state.enabled?void 0:c["default"].createElement("span",{className:"danteDefaultPlaceholder"},this.placeholderText()),c["default"].createElement(p.EditorBlock,Object.assign({},this.props,{editable:!0,className:"imageCaption"}))))}}]),t}(c["default"].Component);t["default"]=y;var m=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){return c["default"].createElement("div",null,this.props.toggle?c["default"].createElement("div",{className:"image-upoader-loader"},c["default"].createElement("p",null,100===this.props.progress?"processing image...":c["default"].createElement("span",null,c["default"].createElement("span",null,"loading")," ",Math.round(this.props.progress)))):void 0)}}]),t}(c["default"].Component)},194:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=(r(c),n(9)),p=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.placeholderText=n.placeholderText.bind(n),n.placeholderFromProps=n.placeholderFromProps.bind(n),n.defaultText=n.defaultText.bind(n),n.handleFocus=n.handleFocus.bind(n),n.classForDefault=n.classForDefault.bind(n),n.state={enabled:!1,data:n.props.blockProps.data.toJS()},n}return a(t,e),l(t,[{key:"placeholderText",value:function(){return this.state.enabled?"":this.props.blockProps.data.toJS().placeholder||this.placeholderFromProps()||this.defaultText()}},{key:"placeholderFromProps",value:function(){return this.props.block.toJS().placeholder}},{key:"defaultText",value:function(){return"write something "}},{key:"componentDidMount",value:function(){}},{key:"handleFocus",value:function(e){var t=this;return setTimeout(function(){return t.setState({enabled:!0})},0)}},{key:"classForDefault",value:function(){return this.state.enabled?"":"defaultValue defaultValue--root"}},{key:"render",value:function(){return u["default"].createElement("span",{className:this.classForDefault(),onMouseDown:this.handleFocus},this.placeholderText(),u["default"].createElement(d.EditorBlock,Object.assign({},this.props,{className:"imageCaption",placeholder:"escrive alalal"})))}}]),t}(u["default"].Component);t["default"]=p},195:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=(r(c),n(9)),p=n(25),f=n(47),h=r(f),g=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.updateData=n.updateData.bind(n),n.dataForUpdate=n.dataForUpdate.bind(n),n.state={embed_data:n.defaultData()},n}return a(t,e),l(t,[{key:"defaultData",value:function(){var e=this.props.block.getData().toJS();return e.embed_data||{}}},{key:"updateData",value:function(){var e=this.props,t=e.block,n=(e.blockProps,this.props.blockProps),r=n.getEditorState,o=n.setEditorState,i=t.getData(),a=i.merge(this.state);return o((0,p.updateDataOfBlock)(r(),t,a))}},{key:"dataForUpdate",value:function(){return this.props.blockProps.data.toJS()}},{key:"componentDidMount",value:function(){var e=this;if(this.props.blockProps.data&&(this.dataForUpdate().endpoint||this.dataForUpdate().provisory_text))return(0,h["default"])({method:"get",url:""+this.dataForUpdate().endpoint+this.dataForUpdate().provisory_text+"&scheme=https"}).then(function(t){return e.setState({embed_data:t.data},e.updateData)})["catch"](function(e){return console.log("TODO: error")})}},{key:"classForImage",value:function(){return this.state.embed_data.thumbnail_url?"":"mixtapeImage--empty u-ignoreBlock"}},{key:"render",value:function(){return u["default"].createElement("figure",{className:"graf--figure graf--iframe graf--first",tabIndex:"0"},u["default"].createElement("div",{className:"iframeContainer",dangerouslySetInnerHTML:{__html:this.state.embed_data.html}}),u["default"].createElement("figcaption",{className:"imageCaption"},u["default"].createElement(d.EditorBlock,Object.assign({},this.props,{className:"imageCaption"}))))}}]),t}(u["default"].Component);t["default"]=g},196:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleToggleReadOnly=e.handleToggleReadOnly.bind(e),e.handleTestEmitAndDecode=e.handleTestEmitAndDecode.bind(e),e.handleTestEmitTEXT=e.handleTestEmitTEXT.bind(e),e.testEmitAndDecode=e.testEmitAndDecode.bind(e),e.testEmitTEXT=e.testEmitTEXT.bind(e),e.logState=e.logState.bind(e),e.toggleDisplay=e.toggleDisplay.bind(e),e.open=e.open.bind(e),e.render=e.render.bind(e),e.state={output:"",display:"none"},e}return a(t,e),l(t,[{key:"handleToggleReadOnly",value:function(e){return e.preventDefault(),this.props.editor.toggleEditable(),!1}},{key:"handleTestEmitAndDecode",value:function(e){return e.preventDefault(),this.testEmitAndDecode()}},{key:"handleTestEmitTEXT",value:function(e){return e.preventDefault(),this.testEmitTEXT()}},{key:"testEmitAndDecode",value:function(e){var t=this.props.editor.emitSerializedOutput();return this.props.editor.setState({editorState:this.props.editor.decodeEditorContent(t)},this.logState(JSON.stringify(t))),!1}},{key:"testEmitTEXT",value:function(){var e=this.props.editor.getTextFromEditor();return this.logState(e)}},{key:"logState",value:function(e){return this.setState({output:e},this.open)}},{key:"toggleDisplay",value:function(e){e.preventDefault();var t="block"===this.state.display?"none":this.state.display;return this.setState({display:t})}},{key:"open",value:function(){return this.setState({display:"block"})}},{key:"render",value:function(){return u["default"].createElement("div",null,u["default"].createElement("div",{className:"debugControls"},u["default"].createElement("ul",null,u["default"].createElement("li",null," LOCKS: ",this.props.editor.state.locks," "),u["default"].createElement("li",null,u["default"].createElement("a",{href:"#",onClick:this.handleToggleReadOnly},"EDITABLE: ",this.props.editor.state.read_only?"NO":"YES")),u["default"].createElement("li",null,u["default"].createElement("a",{href:"#",onClick:this.handleTestEmitTEXT},"EDITOR TEXT")),u["default"].createElement("li",null,u["default"].createElement("a",{href:"#",onClick:this.handleTestEmitAndDecode},"EDITOR STATE")))),u["default"].createElement("div",{className:"debugZone",style:{display:this.state.display}},u["default"].createElement("a",{href:"#",className:"dante-debug-close close",onClick:this.toggleDisplay}),u["default"].createElement("div",{className:"debugOutput"},u["default"].createElement("h2",null,"EDITOR OUTPUT"),this.state.output.length>0?u["default"].createElement("pre",null,this.state.output):void 0)))}}]),t}(u["default"].Component);t["default"]=c},197:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(9),d=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._validateLink=n._validateLink.bind(n),n._checkProtocol=n._checkProtocol.bind(n),n._showPopLinkOver=n._showPopLinkOver.bind(n),n._hidePopLinkOver=n._hidePopLinkOver.bind(n),n.isHover=!1,n}return a(t,e),l(t,[{key:"_validateLink",value:function(){var e=new RegExp("^(https?://)?((([a-zd]([a-zd-]*[a-zd])*).)+[a-z]{2,}|((d{1,3}.){3}d{1,3}))(:d+)?(/[-a-zd%_.~+]*)*(?[&a-zd%_.~+=-]*)?(#[-a-zd_]*)?$","i");return!!e.test(str)||(alert("Please enter a valid URL."),!1)}},{key:"_checkProtocol",value:function(){return console.log("xcvd")}},{key:"_showPopLinkOver",value:function(e){if(this.data.showPopLinkOver)return this.data.showPopLinkOver(this.refs.link)}},{key:"_hidePopLinkOver",value:function(e){if(this.data.hidePopLinkOver)return this.data.hidePopLinkOver()}},{key:"render",value:function(){return this.data=c.Entity.get(this.props.entityKey).getData(),u["default"].createElement("a",{ref:"link",href:this.data.url,className:"markup--anchor",onMouseOver:this._showPopLinkOver,onMouseOut:this._hidePopLinkOver},this.props.children)}}]),t}(u["default"].Component);t["default"]=d},198:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=r(c),p=(n(9),n(25)),f=n(48),h=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.display=n.display.bind(n),n.show=n.show.bind(n),n.hide=n.hide.bind(n),n._toggleScaled=n._toggleScaled.bind(n),n.scale=n.scale.bind(n),n.collapse=n.collapse.bind(n),n.componentWillReceiveProps=n.componentWillReceiveProps.bind(n),n.clickOnFileUpload=n.clickOnFileUpload.bind(n),n.handlePlaceholder=n.handlePlaceholder.bind(n),n.insertImage=n.insertImage.bind(n),n.handleFileInput=n.handleFileInput.bind(n),n.widgets=n.widgets.bind(n),n.clickHandler=n.clickHandler.bind(n),n.relocate=n.relocate.bind(n),n.state={position:{top:0,left:0},show:!1,scaled:!1},n}return a(t,e),l(t,[{key:"display",value:function(e){return e?this.show():this.hide()}},{key:"show",value:function(){return this.setState({show:!0})}},{key:"hide",value:function(){return this.setState({show:!1})}},{key:"setPosition",value:function(e){return this.setState({position:e})}},{key:"_toggleScaled",value:function(e){return this.state.scaled?this.collapse():this.scale()}},{key:"scale",value:function(){return this.setState({scaled:!0})}},{key:"collapse",value:function(){return this.setState({scaled:!1})}},{key:"componentWillReceiveProps",value:function(e){return this.collapse()}},{key:"activeClass",value:function(){return this.isActive()?"is-active":""}},{key:"isActive",value:function(){return this.state.show}},{key:"scaledClass",value:function(){return this.state.scaled?"is-scaled":""}},{key:"scaledWidth",value:function(){return this.state.scaled?"124":"0"}},{key:"clickOnFileUpload",value:function(){return this.refs.fileInput.click(),this.collapse(),this.hide()}},{key:"handlePlaceholder",value:function(e){var t={type:e.widget_options.insert_block,placeholder:e.options.placeholder,endpoint:e.options.endpoint};return this.props.onChange((0,p.resetBlockWithType)(this.props.editorState,"placeholder",t))}},{key:"insertImage",value:function(e){var t={url:URL.createObjectURL(e),file:e};return this.props.onChange((0,p.addNewBlock)(this.props.editorState,"image",t))}},{key:"handleFileInput",value:function(e){var t=e.target.files;return this.insertImage(t[0])}},{key:"widgets",value:function(){return this.props.editor.widgets}},{key:"clickHandler",value:function(e,t){var n=this.widgets().find(function(e){return e.icon===t});switch(n.widget_options.insertion){case"upload":return this.clickOnFileUpload(e,n);case"placeholder":return this.handlePlaceholder(n);default:return console.log("WRONG TYPE FOR "+n.widget_options.insertion)}}},{key:"getItems",value:function(){return this.widgets().filter(function(e){return e.widget_options.displayOnInlineTooltip})}},{key:"isDescendant",value:function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1}},{key:"relocate",value:function(){var e=this.props.editorState;if(e.getSelection().isCollapsed()){var t=(0,p.getCurrentBlock)(e),n=t.getType(),r=e.getCurrentContent(),o=e.getSelection(),i=r.getBlockForKey(o.anchorKey),a=(0,f.getSelection)(window);if(!a.rangeCount)return;var l=((0,p.getNode)(),(0,f.getSelectionRect)(a)),s=l,u=d["default"].findDOMNode(this.props.editor);return u.getBoundingClientRect(),this.isDescendant(u,a.anchorNode)?(this.display(0===i.getText().length&&"unstyled"===n),this.setPosition({top:s.top+window.scrollY,left:s.left+window.scrollX-60})):void this.hide()}return this.hide()}},{key:"render",value:function(){var e=this;return u["default"].createElement("div",{className:"inlineTooltip "+this.activeClass()+" "+this.scaledClass(),style:this.state.position},u["default"].createElement("button",{className:"inlineTooltip-button control",title:"Close Menu","data-action":"inline-menu",onClick:this._toggleScaled},u["default"].createElement("span",{className:"tooltip-icon dante-icon-plus"})),u["default"].createElement("div",{className:"inlineTooltip-menu",style:{width:this.scaledWidth()+"px"}},this.getItems().map(function(t,n){return u["default"].createElement(g,{item:t,key:n,clickHandler:e.clickHandler})}),u["default"].createElement("input",{type:"file",style:{display:"none"},ref:"fileInput",multiple:"multiple",onChange:this.handleFileInput})))}}]),t}(u["default"].Component),g=function(e){function t(){var e;o(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var l=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return l.clickHandler=l.clickHandler.bind(l),l}return a(t,e),l(t,[{key:"clickHandler",value:function(e){return e.preventDefault(),this.props.clickHandler(e,this.props.item.icon)}},{key:"render",value:function(){return u["default"].createElement("button",{className:"inlineTooltip-button scale",title:this.props.title,onMouseDown:this.clickHandler},u["default"].createElement("span",{className:"tooltip-icon dante-icon-"+this.props.item.icon}))}}]),t}(u["default"].Component);t["default"]=h},199:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=r(c),p=(n(9),n(48)),f=n(25),h=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.display=n.display.bind(n),n.show=n.show.bind(n),n.hide=n.hide.bind(n),n._toggleScaled=n._toggleScaled.bind(n),n.scale=n.scale.bind(n),n.collapse=n.collapse.bind(n),n.relocate=n.relocate.bind(n),n.componentWillReceiveProps=n.componentWillReceiveProps.bind(n),n.handleClick=n.handleClick.bind(n),n.state={position:{top:0,left:0},show:!1,scaled:!1,buttons:[{type:"left"},{type:"center"},{type:"fill"},{type:"wide"}]},n}return a(t,e),l(t,[{key:"display",value:function(e){return e?this.show():this.hide()}},{key:"show",value:function(){return this.setState({show:!0})}},{key:"hide",value:function(){return this.setState({show:!1})}},{key:"setPosition",value:function(e){return this.setState({position:e})}},{key:"_toggleScaled",value:function(e){return this.state.scaled?this.collapse():this.scale()}},{key:"scale",value:function(){return this.setState({scaled:!0})}},{key:"collapse",value:function(){return this.setState({scaled:!1})}},{key:"relocate",value:function(){var e=this.props.editorState;if(!e.getSelection().isCollapsed())return this.hide();var t=(0,f.getCurrentBlock)(e),n=t.getType(),r=e.getCurrentContent(),o=e.getSelection(),i=(r.getBlockForKey(o.anchorKey),(0,p.getSelection)(window));if(i.rangeCount){var a=(0,f.getNode)(),l=(0,p.getSelectionRect)(i),s=d["default"].findDOMNode(this.props.editor),u=s.getBoundingClientRect();if(this.display("image"===n),"image"===n){l=a.anchorNode.parentNode.parentNode.parentNode.getBoundingClientRect();var c=this.refs.image_popover,h=c.offsetWidth/2;return this.setPosition({top:l.top-u.top+60,left:l.left+l.width/2-h})}}}},{key:"componentWillReceiveProps",value:function(e){return this.collapse()}},{key:"getStyle",value:function(){if(!this.state.position)return{}}},{key:"handleClick",value:function(e){return this.props.editor.setDirection(e.type)}},{key:"render",value:function(){var e=this;return u["default"].createElement("div",{ref:"image_popover",className:"dante-popover popover--Aligntooltip popover--top popover--animated "+(this.state.show?"is-active":void 0),style:{top:this.state.position.top,left:this.state.position.left}},u["default"].createElement("div",{className:"popover-inner"},u["default"].createElement("ul",{className:"dante-menu-buttons"},this.state.buttons.map(function(t,n){return u["default"].createElement(g,{item:t,handleClick:e.handleClick,key:n})}))),u["default"].createElement("div",{className:"popover-arrow"}))}}]),t}(u["default"].Component),g=function(e){function t(){var e;o(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var l=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return l.handleClick=l.handleClick.bind(l),l.render=l.render.bind(l),l}return a(t,e),l(t,[{key:"handleClick",value:function(e){return e.preventDefault(),this.props.handleClick(this.props.item)}},{key:"render",value:function(){return u["default"].createElement("li",{className:"dante-menu-button align-"+this.props.item.type,onMouseDown:this.handleClick},u["default"].createElement("span",{className:"tooltip-icon dante-icon-image-"+this.props.item.type}))}}]),t}(u["default"].Component);t["default"]=h},200:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=r(c),p=n(25),f=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.display=n.display.bind(n),n.show=n.show.bind(n),n.hide=n.hide.bind(n),n.relocate=n.relocate.bind(n),n.render=n.render.bind(n),n.state={position:{top:0,left:0},show:!1,url:""},n}return a(t,e),l(t,[{key:"display",value:function(e){return e?this.show():this.hide()}},{key:"show",value:function(){return this.setState({show:!0})}},{key:"hide",value:function(){return this.setState({show:!1})}},{key:"setPosition",value:function(e){return this.setState({position:e})}},{key:"relocate",value:function(e){if(null==e&&(e=null),e){var t=this.props.editorState,n=(0,p.getCurrentBlock)(t),r=(n.getType(),t.getCurrentContent(),t.getSelection(),e.getBoundingClientRect()),o=this.refs.dante_popover,i=o.offsetWidth/2,a=d["default"].findDOMNode(this.props.editor),l=a.getBoundingClientRect();return{top:r.top-l.top+160,left:r.left+r.width/2-i}}}},{key:"render",value:function(){var e=this.state.position,t={left:e.left,top:e.top,visibility:""+(this.state.show?"visible":"hidden")};return u["default"].createElement("div",{ref:"dante_popover",className:"dante-popover popover--tooltip popover--Linktooltip popover--bottom is-active",style:t,onMouseOver:this.props.handleOnMouseOver,onMouseOut:this.props.handleOnMouseOut},u["default"].createElement("div",{className:"popover-inner"},u["default"].createElement("a",{href:this.props.url,target:"_blank"},this.state.url)),u["default"].createElement("div",{className:"popover-arrow"}))}}]),t}(u["default"].Component);t["default"]=f},201:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{
"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),u=r(s),c=n(13),d=r(c),p=n(9),f=n(48),h=n(25),g=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._clickInlineHandler=n._clickInlineHandler.bind(n),n.display=n.display.bind(n),n.show=n.show.bind(n),n.hide=n.hide.bind(n),n.relocate=n.relocate.bind(n),n._clickBlockHandler=n._clickBlockHandler.bind(n),n.displayLinkMode=n.displayLinkMode.bind(n),n.displayActiveMenu=n.displayActiveMenu.bind(n),n._enableLinkMode=n._enableLinkMode.bind(n),n._disableLinkMode=n._disableLinkMode.bind(n),n.handleInputEnter=n.handleInputEnter.bind(n),n.confirmLink=n.confirmLink.bind(n),n.inlineItems=n.inlineItems.bind(n),n.blockItems=n.blockItems.bind(n),n.getDefaultValue=n.getDefaultValue.bind(n),n.getVisibleSelectionRect=p.getVisibleSelectionRect,n.state={link_mode:!1,show:!1,position:{}},n}return a(t,e),l(t,[{key:"_clickInlineHandler",value:function(e,t){var n=this;return e.preventDefault(),this.props.onChange(p.RichUtils.toggleInlineStyle(this.props.editorState,t)),setTimeout(function(){return n.relocate()},0)}},{key:"display",value:function(e){return e?this.show():this.hide()}},{key:"show",value:function(){return this.setState({show:!0})}},{key:"hide",value:function(){return this.setState({link_mode:!1,show:!1})}},{key:"setPosition",value:function(e){return this.setState({position:e})}},{key:"isDescendant",value:function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1}},{key:"relocate",value:function(){var e=(0,h.getCurrentBlock)(this.props.editorState),t=e.getType();if(this.props.configTooltip.selectionElements.indexOf(t)<0)return void this.hide();if(!this.state.link_mode&&this.state.show){var n=this.refs.dante_menu,r=n.offsetWidth/2,o=(0,f.getSelection)(window);if(o.rangeCount){var i=(0,f.getSelectionRect)(o),a=d["default"].findDOMNode(this.props.editor),l=a.getBoundingClientRect();if(!this.isDescendant(a,o.anchorNode))return void this.hide();var s=i.top-l.top- -90-5,u=i.left+i.width/2-r;if(s&&u)return this.setState({show:!0,position:{left:u,top:s}})}}}},{key:"_clickBlockHandler",value:function(e,t){var n=this;return e.preventDefault(),this.props.onChange(p.RichUtils.toggleBlockType(this.props.editorState,t)),setTimeout(function(){return n.relocate()},0)}},{key:"displayLinkMode",value:function(){return this.state.link_mode?"dante-menu--linkmode":""}},{key:"displayActiveMenu",value:function(){return this.state.show?"dante-menu--active":""}},{key:"_enableLinkMode",value:function(e){return e.preventDefault(),this.setState({link_mode:!0})}},{key:"_disableLinkMode",value:function(e){return e.preventDefault(),this.setState({link_mode:!1,url:""})}},{key:"hideMenu",value:function(){return this.hide()}},{key:"handleInputEnter",value:function(e){if(13===e.which)return this.confirmLink(e)}},{key:"confirmLink",value:function(e){e.preventDefault();var t=this.props.editorState,n=e.currentTarget.value,r=(t.getCurrentContent(),t.getSelection()),o={url:n,showPopLinkOver:this.props.showPopLinkOver,hidePopLinkOver:this.props.hidePopLinkOver},i=p.Entity.create("LINK","MUTABLE",o);return r.isCollapsed()?void console.log("COLLAPSED SKIPPING LINK"):(this.props.onChange(p.RichUtils.toggleLink(t,r,i)),this._disableLinkMode(e))}},{key:"getPosition",value:function(){var e=this.state.position;return e}},{key:"inlineItems",value:function(){return this.props.widget_options.block_types.filter(function(e){return"inline"===e.type})}},{key:"blockItems",value:function(){return this.props.widget_options.block_types.filter(function(e){return"block"===e.type})}},{key:"getDefaultValue",value:function(){var e=this;this.refs.dante_menu_input&&(this.refs.dante_menu_input.value="");var t=(0,h.getCurrentBlock)(this.props.editorState),n=(t.getType(),this.props.editor.state.editorState.getSelection()),r=null,o=null;return t.findEntityRanges(function(e){var t=e.getEntity();return r=t,null!==t&&"LINK"===p.Entity.get(t).getType()},function(t,i){var a=n.getAnchorOffset(),l=n.getFocusOffset();if(n.getIsBackward()&&(a=n.getFocusOffset(),l=n.getAnchorOffset()),t===a&&i===l)return o=p.Entity.get(r).getData().url,e.refs.dante_menu_input.value=o})}},{key:"render",value:function(){var e=this;return u["default"].createElement("div",{id:"dante-menu",ref:"dante_menu",className:"dante-menu "+this.displayActiveMenu()+" "+this.displayLinkMode(),style:this.getPosition()},u["default"].createElement("div",{className:"dante-menu-linkinput"},u["default"].createElement("input",{className:"dante-menu-input",ref:"dante_menu_input",placeholder:"Paste or type a link",onKeyPress:this.handleInputEnter,defaultValue:this.getDefaultValue()}),u["default"].createElement("div",{className:"dante-menu-button",onMouseDown:this._disableLinkMode})),u["default"].createElement("ul",{className:"dante-menu-buttons"},this.blockItems().map(function(t,n){return u["default"].createElement(y,{key:n,item:t,handleClick:e._clickBlockHandler,editorState:e.props.editorState,type:"block",currentStyle:e.props.editorState.getCurrentInlineStyle})}),u["default"].createElement(m,{editorState:this.props.editorState,enableLinkMode:this._enableLinkMode}),this.inlineItems().map(function(t,n){return u["default"].createElement(y,{key:n,item:t,type:"inline",editorState:e.props.editorState,handleClick:e._clickInlineHandler})})))}}]),t}(u["default"].Component),y=function(e){function t(){var e;o(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var l=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return l.handleClick=l.handleClick.bind(l),l.activeClass=l.activeClass.bind(l),l.isActive=l.isActive.bind(l),l.activeClassInline=l.activeClassInline.bind(l),l.activeClassBlock=l.activeClassBlock.bind(l),l.render=l.render.bind(l),l}return a(t,e),l(t,[{key:"handleClick",value:function(e){return this.props.handleClick(e,this.props.item.style)}},{key:"activeClass",value:function(){return this.isActive()?"active":""}},{key:"isActive",value:function(){return"block"===this.props.type?this.activeClassBlock():this.activeClassInline()}},{key:"activeClassInline",value:function(){if(this.props.editorState)return this.props.editorState.getCurrentInlineStyle().has(this.props.item.style)}},{key:"activeClassBlock",value:function(){if(this.props.editorState){var e=this.props.editorState.getSelection(),t=this.props.editorState.getCurrentContent().getBlockForKey(e.getStartKey()).getType();return this.props.item.style===t}}},{key:"render",value:function(){return u["default"].createElement("li",{className:"dante-menu-button "+this.activeClass(),onMouseDown:this.handleClick},u["default"].createElement("i",{className:"dante-icon dante-icon-"+this.props.item.label,"data-action":"bold"}))}}]),t}(u["default"].Component),m=function(e){function t(){var e;o(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var l=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return l.promptForLink=l.promptForLink.bind(l),l}return a(t,e),l(t,[{key:"promptForLink",value:function(e){var t=this.props.editorState.getSelection();if(!t.isCollapsed())return this.props.enableLinkMode(e)}},{key:"render",value:function(){return u["default"].createElement("li",{className:"dante-menu-button",onMouseDown:this.promptForLink},u["default"].createElement("i",{className:"dante-icon icon-createlink","data-action":"createlink"},"link"))}}]),t}(u["default"].Component);t["default"]=g},203:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=function(e,t,n,o){return n.findEntityRanges(function(n){return function(n){var o,i,a;return o=n.getEntity(),a=null!==o&&r.Entity.get(o).getType()===e,a?(i={showPopLinkOver:t.showPopLinkOver,hidePopLinkOver:t.hidePopLinkOver},r.Entity.mergeData(o,i)):void 0,a}}(void 0),o)};t["default"]=o},204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=(n(41),function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}),i=function(e){return{contentType:"image",imgSrc:e.getAttribute("src")}},a=function(e){if(null===e)return null;var t=document.createElement("blockquote");return t.innerText=JSON.stringify(e),t},l=function(e,t){if(t instanceof HTMLElement){var n=s(e);return n.parentNode.insertBefore(t,n)}},s=function(e){for(;e.parentNode;)if("BODY"!==e.parentNode.tagName&&(e=e.parentNode),"BODY"===e.parentNode.tagName)return e},u=o(a,i),c=function(e){return l(e,u(e))},d=function(e,t){var n=(new DOMParser).parseFromString(e,"text/html");n.querySelectorAll("img").forEach(function(e){return c(e)}),console.log(n.body.innerHTML);var o=(0,r.convertFromHTML)(n.body.innerHTML,r.getSafeBodyFromHTML,t);return o=o.map(function(e){var t=void 0;if(console.log("CHECK BLOCK",e.getType()),"blockquote"!==e.getType())return e;var n="";try{n=JSON.parse(e.getText())}catch(r){return e}return t=e.merge({type:"image",text:"",data:{url:n.imgSrc,forceUpload:!0}})}),n=null,r.ContentState.createFromBlockArray(o)};t["default"]=d},205:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(47),l=r(a),s=n(41),u=r(s),c=function(){function e(t){o(this,e),this.getLocks=t.getLocks,this.config=t.config,this.editorContent=t.editorContent,this.editorState=t.editorState}return i(e,[{key:"handleStore",value:function(e){return this.store()}},{key:"store",value:function(e){var t=this;if(this.config.data_storage.url&&!(this.getLocks()>0))return clearTimeout(this.timeout),this.timeout=setTimeout(function(){return t.checkforStore(e)},this.config.data_storage.interval)}},{key:"getTextFromEditor",value:function(e){return e.blocks.map(function(e){return e.text}).join("\n")}},{key:"getUrl",value:function(){var e=this.config.data_storage.url;return"function"==typeof e?e():e}},{key:"getMethod",value:function(){var e=this.config.data_storage.method;return"function"==typeof e?e():e}},{key:"checkforStore",value:function(e){var t=this,n=!u["default"].is(u["default"].fromJS(this.editorContent),u["default"].fromJS(e));if(n)return this.config.xhr.before_handler&&this.config.xhr.before_handler(),(0,l["default"])({method:this.getMethod(),url:this.getUrl(),data:{editor_content:JSON.stringify(e),text_content:this.getTextFromEditor(e)}}).then(function(e){if(t.config.data_storage.success_handler&&t.config.data_storage.success_handler(e),t.config.xhr.success_handler)return t.config.xhr.success_handler(e)})["catch"](function(e){if(t.config.xhr.failure_handler)return t.config.xhr.failure_handler(e)})}}]),e}();t["default"]=c},280:function(e,t){},302:function(e,t,n){e.exports=n.p+"fonts/dante.svg"},303:function(e,t,n){e.exports=n.p+"fonts/dante.ttf"},304:function(e,t,n){e.exports=n.p+"fonts/dante.woff"},305:function(e,t,n){e.exports=n.p+"fonts/fontello.svg"},306:function(e,t,n){e.exports=n.p+"fonts/fontello.ttf"},307:function(e,t,n){e.exports=n.p+"fonts/fontello.woff"}});
//# sourceMappingURL=dante.js.map